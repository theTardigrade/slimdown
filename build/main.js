var __extends=this&&this.n||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,e){n.__proto__=e}||function(n,e){for(var r in e)e.hasOwnProperty(r)&&(n[r]=e[r])};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Util=function(){function i(){}return i.e=function(n){switch(n){case" ":case"\n":case"\r":case"\t":case"\v":case"\f":return!0}return!1},i.trimSpace=function(n){for(var e=n.length-1,r=0,t=e;r<=t&&i.e(n.charAt(r));)++r;for(;r<t&&i.e(n.charAt(t));)--t;return 0<r||t<e?n.slice(r,t+1):n},i}(),Token=function(){function n(n,e){this.r=n,this.t=e}return Object.defineProperty(n.prototype,"type",{get:function(){return this.r},set:function(n){this.r=n},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"value",{get:function(){return this.t},set:function(n){this.t=n},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"length",{get:function(){return this.t.length},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isNull",{get:function(){return"NULL"===this.r},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isEndOfFile",{get:function(){return"EOF"===this.r},enumerable:!0,configurable:!0}),n.prototype.toString=function(){return'[TOKEN type="'+this.r+'" value="'+this.t+'"]'},n.newEndOfFile=function(){return new n("EOF","")},n.newNull=function(){return new n("NULL","")},n}(),TokenList=function(){function e(n){this.i=Object.freeze(n.slice(0))}return Object.defineProperty(e.prototype,"first",{get:function(){return this.i[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"second",{get:function(){return this.i[1]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"third",{get:function(){return this.i[2]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fourth",{get:function(){return this.i[3]},enumerable:!0,configurable:!0}),e.prototype.peek=function(n){if("string"==typeof n)return this.peek([n]);if(!this.i.length)return!1;for(var e=0,r=n.length;e<r;++e)if(n[e]!==this.i[e].type)return!1;return!0},e.prototype.peek_or=function(n){if("string"==typeof n[0])return this.peek_or([n]);for(var e=0,r=n.length;e<r;++e)if(this.peek(n[e]))return!0;return!1},e.prototype.peek_at=function(n,e){return this.offset(n).peek(e)},e.prototype.offset=function(n){return 0===n?this:new e(this.i.slice(n))},Object.defineProperty(e.prototype,"count",{get:function(){return this.i.length},enumerable:!0,configurable:!0}),e}(),SimpleScanner=function(){function r(){}return r.fromString=function(n){var e=n.charAt(0);return e in r.TOKEN_TYPES?new Token(r.TOKEN_TYPES[e],e):Token.newNull()},r.TOKEN_TYPES=Object.freeze({_:"UNDERSCORE","*":"STAR","\n":"NEWLINE"}),r}(),TextScanner=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return __extends(e,n),e.fromString=function(n){var e,r,t;for(e=0,r=n.length;e<r&&(t=n.charAt(e),SimpleScanner.fromString(t).isNull);++e);return new Token("TEXT",n.slice(0,e))},e}(SimpleScanner),Tokenizer=function(){function i(){}return i.tokenize=function(n){return new TokenList(this.u(Util.trimSpace(n)))},i.u=function(n){if(!n.length)return[Token.newEndOfFile()];var e=this.s(n);return[e].concat(this.u(n.slice(e.length)))},i.s=function(n){for(var e=0,r=i.SCANNERS.length;e<r;++e){var t=i.SCANNERS[e].fromString(n);if(!t.isNull)return t;e+=t.length}throw new Error("Could not scan token.")},i.SCANNERS=Object.freeze([SimpleScanner,TextScanner]),i}(),BaseParser=function(){function n(){}return n.matchFirst=function(n,e){for(var r=0,t=e.length;r<t;++r){var i=e[r].match(n);if(!i.isNull)return i}return BaseNode.newNull()},n.matchStar=function(n,e){for(var r=[],t=0;;){var i=e.match(n.offset(t));if(i.isNull)break;r.push(i),t+=i.consumed}return{nodes:r,consumed:t}},n}(),PlainTextParser=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return __extends(e,n),e.match=function(n){return n.peek("TEXT")?new BaseNode("PLAIN_TEXT",n.first.value,1):BaseNode.newNull()},e}(BaseParser),EmphasizedBoldTextParser=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return __extends(e,n),e.match=function(n){return n.peek_or([["STAR","STAR","UNDERSCORE","TEXT","UNDERSCORE","STAR","STAR"],["UNDERSCORE","STAR","STAR","TEXT","STAR","STAR","UNDERSCORE"],["STAR","UNDERSCORE","UNDERSCORE","TEXT","UNDERSCORE","UNDERSCORE","STAR"],["UNDERSCORE","UNDERSCORE","STAR","TEXT","STAR","UNDERSCORE","UNDERSCORE"]])?new BaseNode("EMPHASIZED_BOLD_TEXT",n.fourth.value,7):BaseNode.newNull()},e}(BaseParser),EmphasizedTextParser=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return __extends(e,n),e.match=function(n){return n.peek_or([["UNDERSCORE","TEXT","UNDERSCORE"],["STAR","TEXT","STAR"]])?new BaseNode("EMPHASIZED_TEXT",n.second.value,3):BaseNode.newNull()},e}(BaseParser),BoldTextParser=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return __extends(e,n),e.match=function(n){return n.peek_or([["UNDERSCORE","UNDERSCORE","TEXT","UNDERSCORE","UNDERSCORE"],["STAR","STAR","TEXT","STAR","STAR"]])?new BaseNode("BOLD_TEXT",n.third.value,5):BaseNode.newNull()},e}(BaseParser),SentenceParser=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return __extends(e,n),e.match=function(n){return BaseParser.matchFirst(n,e.PARSERS)},e.PARSERS=[EmphasizedBoldTextParser,EmphasizedTextParser,BoldTextParser,PlainTextParser],e}(BaseParser),SentencesAndNewlineParser=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return __extends(e,n),e.match=function(n){var e=BaseParser.matchStar(n,SentenceParser),r=e.nodes,t=e.consumed;if(!r.length||!n.peek_at(t,["NEWLINE"]))return BaseNode.newNull();++t;for(var i=0;;++i)if(!n.peek_at(t+i,["NEWLINE"])){t+=i;break}return new BaseNode("PARAGRAPH","",t,r)},e}(BaseParser),SentencesAndEndOfFileParser=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return __extends(e,n),e.match=function(n){var e=BaseParser.matchStar(n,SentenceParser),r=e.nodes,t=e.consumed;if(!r.length)return BaseNode.newNull();if(n.peek_at(t,["EOF"]))++t;else{if(!n.peek_at(t,["NEWLINE","EOF"]))return BaseNode.newNull();t+=2}return new BaseNode("PARAGRAPH","",t,r)},e}(BaseParser),ParagraphParser=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return __extends(e,n),e.match=function(n){return BaseParser.matchFirst(n,e.PARSERS)},e.PARSERS=[SentencesAndNewlineParser,SentencesAndEndOfFileParser],e}(BaseParser),BodyParser=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return __extends(e,n),e.match=function(n){var e=BaseParser.matchStar(n,ParagraphParser),r=e.nodes,t=e.consumed;return t?new BaseNode("BODY","",t,r):BaseNode.newNull()},e}(BaseParser),Parser=function(){function n(){}return n.parse=function(n){var e=BodyParser.match(n);if(e.consumed<n.count)throw new Error("Not all tokens consumed.");return e},n}(),BaseNode=function(){function n(n,e,r,t){this.type=n,this.text=t&&t.length?"":e,this.consumed=r||0,this.childNodes=t||[],this.isNull="NULL"===n}return n.newNull=function(){return new n("NULL","")},n.prototype.toString=function(){if(this.isNull)return"";var n=[];switch(this.type.toUpperCase()){case"PARAGRAPH":n.push("p");break;case"EMPHASIZED_BOLD_TEXT":n.push("strong");case"EMPHASIZED_TEXT":n.push("em");break;case"BOLD_TEXT":n.push("strong")}for(var e="",r=0,t=n.length;r<t;++r)e+="<"+n[r]+">";if(this.text.length)e+=this.text;else{var i=this.childNodes;for(r=0,t=i.length;r<t;++r)e+=i[r].toString()}for(r=n.length-1;0<=r;--r)e+="</"+n[r]+">";return e},n}();module.exports=function(n){var e=Tokenizer.tokenize(n);return Parser.parse(e).toString()};